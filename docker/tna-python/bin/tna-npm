#!/bin/bash

set -e

if ! type npm &> /dev/null
then
  [[ -z $NODE_ENV ]] && NODE_ENV=$ENVIRONMENT
  . "$NVM_DIR/nvm.sh" && true
  if [ -f "/app/.nvmrc" ]
  then
    NVM_NODE_VERSION=$(cat /app/.nvmrc)
    nvm install $NVM_NODE_VERSION
    nvm use $NVM_NODE_VERSION --silent
  else
    nvm use default --silent
  fi
fi

npm "$@"
